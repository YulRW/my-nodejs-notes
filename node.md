# node

记笔记很重要！！（归类整理）

为什么学Node-->招聘上来讲：具有服务端开发经验更好



Node.js是js运行时环境--》可以解释并执行js代码--》可以用nodejs脱离浏览器来运行！。不是语言也不是库不是框架

1. nodejs里面包含

​	ecmascript（没有dom和bom）

**在node这个js环境中为js提供了一些服务器级别的操作api（可以控制服务器）

​	例如：文件读写

​	网络服务构建

​	网络通信

​	（所以主要做服务端这些事儿



解析js代码---->js引擎 （v8引擎），他是解析执行js代码的机器---是一个虚拟机

**nodejs的作者把v8引擎移植出来做了开发了独立的js运行环境





学nodejs----》学web服务器开发



2. node使用了（特性） 1. 事件驱动
   		2. 非阻塞IO模型（简单来讲就是异步操作）
     		3. 轻量和高效
3. npm是基于nodejs开发的包管理工具，是世界上最大的开源库生态系统（让开发人员更方便地下载和使用）





### nodejs能做什么？

web服务器后台（php ，java）

命令行工具（git（c），npm（node），hexo（node），在命令行下运行的工具----》用命令来开发）----》是辅助类工具

对于前段开发工程师来讲，接触node最多的是命令行工具，但是自己写的很少，主要是用别人的：webpack，gulp，npm，



要知道一些简单的命令行操作：cd（切换   dir（列出目录  ls（列出目录

mkdir rm 等





##### 一些资源：

深入浅出nodejs---》学node底层最好，，偏理论，几乎没有实战内容，纯底层，帮助理解原理，底层有帮助，需要一些基础。

nodejs权威指南--》api讲解，无业务无实战

学习是个过程--》要慢慢学，多几遍学习 

node入门——》推荐去看  nodebeginner.org

cnodejs 里面有很多不错的资源



##### 这门课学到了什么？



B/S变成模型（浏览器和服务器模型  browser-server  back-end 任何服务端技术这种BS编程模型都是一样的，和语言无关，即模型和概念是一样的

node只是作为我们学习BS编程模型的工具而已，技术只是工具

，只要能解决问题的都是好东西

模块化编程

- require js
- seajs
- @import（‘’）（js不行，以前js必须要通过html页面的标签才能使用
- 在node中可以像@import来引用加载js脚本文件

node常用的api



- 异步编程

- 回调函数（在node里面有很多很多0
  - promise
  - async
  - generator
- express web 开发框架
- es 6 （穿插讲解

##### 学习node不仅可以帮助大家打开服务端黑盒子，还可以帮助学习前端高级内容：vue react angular（有很大帮助！！！





## 2.起步

下载，安装  



执行代码：文件就是.js文件，没有html页面

如何运行js？

用命令工具行--》cd切换过去

或者：在目录那边，用gitbush就可以打开（用什么都行

或者：按住shift+右键也可以打开命令行窗口



1. 定位到相应的目录
2. node + 文件
3. 运行！这个时候已经脱离浏览器运行了



#### 01-没有bom和dom

log（document），log（window 

但是可以有：

- 读写文件（浏览器不能读某个文件的内容，不能生成文件写文件



#### 02-读取文件

//浏览器中的js是没有文件操作能力而node可以

--》buffer是二进制数据

文件中存储的其实是二进制01数据

但为什么看到不是01呢，是因为2转到16进制了。

我们可以通过toString转成字符

cls清屏 （clear



#### 07 简单的http服务 

node可以非常轻松的构建一个web 服务器 ，非常简单

在node中专门提供了一个核心模块：http

http这个模块的职责就是帮忙创建服务器的

tip：命令工具按上箭头可以快速用上一条  命令



服务器设置

服务器启动



服务器启动后不能再使用工具命令行，包括cd之类，以及一些其他操作，而且不能关闭

ctrl+c 关闭服务器  



所有请求路径都是以/开头



代码如果修改了一定要重启服务器才生效



遇到问题：response.write()写出的内容如果是中文那么会返回乱码

思考：请求不同的路径的时候响应不同的结果



现在可以根据发送请求的不同路径而返回字符串，但是还要学如何返回不同的html、json等





res.write()其实比较麻烦，一般很少会用。

推荐直接end的同时发送响应数据

res.end(“hello”)//发送响应数据的同时结束响应

注意，响应内容只能是二进制或者字符串，其他都不行（数字，对象，数组，布尔）



favicon.ico请求：浏览器标签请求



#### 先讲模块 08-

node中有：

- ecmascript
  - 没有dom bom
- 核心模块
- 第三方模块
- 用户自定义模块



##### 核心模块 

在node中为js提供了很多服务器级别的api，这些api很多都包装到了具名的核心模块中了

例如，文件操作的fs核心模块 http服务 的核心模块 path路径操作模块  os操作系统信息模块等等等等



以后只要说这个模块是核心模块，就要想到要使用就要引用

var fs = require('fs')

os:operation system



#### 模块化编程

引入js文件

require是一个方法，他的作用是用来加载模块的

在node中模块有三种

- 具名的核心模块

- 用户自己编写的文件模块（说白了就是js

  require引入时，相对路径必须加./或者../，不然就会被当做核心模块了，后缀名（.js）可以省略

require模型的执行顺序：执行引入的模块后再出来继续执行原有模块

node中没有全局作用域只有模块作用域

单个模块用不了外部文件的属性，外部文件也拿不到他的属性

##### 模块间如何通信？

有时候加载文件的目的不是为了简单地执行代码，更重要的是使用里面的某个成员



--加载与导出

require方法有两个作用，

- 加载文件模块并执行代码
- 拿到被加载文件模块导出的接口对象

每个文件模块（js）都提供了一个exports对象（使require有返回值

exports默认是空对象

我们要做的是把所有对象成员挂载到exports成员对象中

exports.foo = "hello world"



#### ip地址和端口号

计算机只有一个物理网卡

同一个局域网中网卡的地址必须是唯一的

网卡是通过唯一的ip地址来进行定位的

所有需要联网的软件都要网络通信，

服务器可能有多个需要网络通信的软件，所以当其他客户端发送请求时需要知道这个请求对应的是服务器哪个通信软件，所以用端口号来判别



所以：ip地址用来定位计算机

端口号用来定位具体的应用程序

--》所有需要联网通信的软件都必须具有端口号



需要注意的是：响应回去的数据也必须要端口号

在服务器可以通过request.socket.remotePort来拿到客户端的端口号

我们的API已经高度封装，不需要知道IP地址和端口号，只需要发送响应就可以了

（实际上服务器也需要知道客户端的IP地址和端口号才能发送回数据）

客户端的浏览器会自动开一个端口号进行通信

什么时候用80端口？网站部署上线时用80，这样用户就不用手动输入端口号了（浏览器默认加80）



##### 总结

request

端口号

模块



一个项目需要依赖n多文件构成

可以同时开启多个服务，但其端口号不能一样（同一时间不能被同一程序占用

中文乱码问题

---》其实不是中文乱码的问题，是在服务器默认发送的数据，其实是utf8编码的内容

但是浏览器不知道你是utf8编码的内容 

浏览器在不知道服务器响应内容的编码的情况下会按照当前操作系统的默认编码去解析

中文操作系统默认是gdk，所以解析不正确--》乱码

所以要告诉浏览器发送的是utf8

不同类型的content-type 



如何通过一个地址访问html？？？

以前--》通过把html扔进apache然后设置默认打开页面

现在node：要创建apache（因为没有apache的能力）



读文件返回的data默认是二进制文件，可以通过toString转为咱们能识别的字符串

图片就不需要指定编码了，一般常说的编码指的是字符编码，所以把charset=utf-8去掉



url：统一资源定位符---》url最终是定位到一个资源的



总结：结合fs发送文件数据

Content-Type不一样



















